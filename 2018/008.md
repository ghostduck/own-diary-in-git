# SSH Tunneling
`ssh -L`

Set a local port in your current machine to somewhere else. In other words, they throw their port to yours.

```
# Syntax
https://www.tunnelsup.com/how-to-create-ssh-tunnels/
ssh -L <LOCAL PORT>:<REMOTE HOST THEY THROW>:<REMOTE PORT THEY THROW> <GATEWAY>

```

Need to make sure the gateway has access to the remote host, otherwise it just won't work.

Also, remote host and remote port can be the same machine as gateway.

One usage of 'same machine' case can be: you want to visit their webpage but got firewalled (no direct connection to their port `80`).

You can forward their port `80` to your local `8080`.
`ssh -L 8080:sshhost:80 loginname@sshhost`

Then you can visit "your 8080" to view the website.

# cronjob and cron tab, allowlist
`/etc/cron.allow` and `/etc/cron.deny` only controls who can run `crontab`.  

If a job is already added to cron entry for unknown reason, even if they are in `etc/cron.deny`, the job will still run.

# Bash
## Helps debugging 

```
# debug mode
exec 5> command.txt
BASH_XTRACEFD="5"
set -x
# end debug mode with set +x
```

It will keeps recording commands you run in script to `command.txt`, until it sees `set +x`.

## Syntax
```
if test $? -ne 0 ; then
...
fi
```

EZ?

```
if [ $? - ne 0 ] then
...
fi 
```
OMFG, don't miss that `;`

`rh_ver= $( lsb_release -r | cut -f2 | cut -d'.' -f1 > /dev/null )`

Spot the mistakes: 
- space after =
- redirect to null should be done outside
- or redirect is not needed at all (check Misc part about `$()`)

## awk in script
`awk` in script is a bit different than `awk` in terminal ... because you need to escape the quotes.

An example in script:
```bash
awkscript='{
        if ($4 == gid) {
                print $3 ":" $4 ":" $1 ":" $5
        }
}'

# ...

awk -F":" -v gid="$gid" "$awkscript" /etc/passwd | sort
echo "Number of lines: `awk -F":" -v gid="$gid" "$awkscript" /etc/passwd | sort | wc -l` "

lastid=`awk -F":" -v gid="$gid" "$awkscript" /etc/passwd | sort | tail -n 1 | cut -d ':' -f 1`
count=`awk -F":" -v gid="$gid" "$awkscript" /etc/passwd | sort | wc -l`

```

You pass variable `gid` with `gid="$gid"`, and the inline awk script needs to be quoted (`$awkscript`)

## Misc
`$()` reads output from stdin then assign it to a variable, so don't use `grep -q` in `$()`

